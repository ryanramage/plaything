<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zoom + Pan</title>
<script src="../../../js/d3.v2.min.js"></script>
<style>

svg {
  font: 10px sans-serif;
  shape-rendering: crispEdges;
}

rect.bg {
  fill: #efefef;
}

rect.tag {
  fill: steelblue;
    fill: green;
    stroke: #fff;
    fill-opacity: .125;
}

.brush .extent {
  stroke: #fff;
  fill-opacity: .125;
  shape-rendering: crispEdges;
}

.axis path, .axis line {
  fill: none;
  stroke: #fff;
}

</style>
<body>
<script>

var data = [
    { start: new Date(2011, 01,01), end: new Date(2011,01,02)},
    { start: new Date(2011, 01,03), end: new Date(2011,01,04)},
];

var images = [
    {
        start: new Date(2011, 01,01), end: new Date(2011,01,02),
        url: 'http://svg-edit.googlecode.com/svn/branches/2.5.1/editor/images/logo.png',
        width: 37, height: 59
    }
]

var journals = [
    {
        day: new Date(2011, 01,01),
        entry : "Today was good, I had some pizza<br/>and pie!"
    }

]


var margin = {top: 0, right: 0, bottom: 12, left: 24},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var x = d3.time.scale()
    .domain([new Date(1975, 0, 1), new Date()])
    .range([0, width]);

var y = d3.scale.linear()
    .domain([0, height])
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom")
    .tickSize(-height);

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .ticks(0)
    .tickSize(-width);

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .call(d3.behavior.zoom().x(x).scaleExtent([0.5, 125000000]).on("zoom", zoom));

svg.append("defs")
    .append("clipPath")
    .attr("id", "clip")
    .append("rect")
          .attr("width", width)
          .attr("height", height);

svg.append("rect")
    .attr("class", "bg")
    .attr("width", width)
    .attr("height", height);

var tags =  svg.append("g")
    //.attr("transform", "translate(" + margin.left + "," + margin.top + ")")



/** The scrubber **/

svg.append('line')
        .attr("x1", width/2 - 1)
        .attr("y1", 1)
        .attr("x2", width/2 - 1)
        .attr("y2", height)
        .style("stroke", "rgb(6,120,155)");


/*
var tag_area = d3.svg.area()

        .x1(function(d) { return x(d.start);   })
        .x0(function(d) { return x(d.end);  })
        .y1(20)
        .y0(150);

*/




tags.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);

tags.append("g")
    .attr("class", "y axis")
    .call(yAxis);




var tag_space = tags.append("g").attr("clip-path", "url(#clip)");

tag_space.selectAll("rect")
.data(data)
.enter().append("rect")
.attr("class", "tag")
    .attr("x", function(d) {  return x(d.start); })
    .attr("y", 20)
    .attr("height",50)
    .attr("width", function(d) {  return x(d.end) - x(d.start); })
    .attr("fill", "#2d578b");


var scrapbook_space = tags.append("g").attr("clip-path", "url(#clip)");

var sc_width = function(d) {
    var date_width =  x(d.end) - x(d.start);
    var img_width = d.width;
    if(img_width < date_width) return img_width;
    return date_width;
}


scrapbook_space.selectAll('image')
        .data(images)
        .enter().append('image')
        .attr('class', 'scrap')
        .attr('x', function(d) {  return x(d.start); })
        .attr('y', 150)
        .attr('width', sc_width)
        .attr('height', function(d) {return d.height })
        .attr('xlink:href', function(d) {return d.url})


var journal_space = tags.append("g").attr("clip-path", "url(#clip)");

journal_space.selectAll('div')
        .data(journals)
        .enter().append('div')
        .attr('x', function(d) {  return x(d.day); })
        .attr('y', 250)
        .attr('width', 100)
        .attr('height',100)
        .innerHTML('adhjdsjadsak')



function zoom() {

    tags.select(".x.axis").call(xAxis);
    tags.select(".y.axis").call(yAxis);


    var range = x.domain();
    var scrubber_date = new Date( d3.mean(range, function(d){ return d.getTime()  }));

    tag_space.selectAll("rect").attr("x", function(d) {  return x(d.start); }).attr("width", function(d) {  return x(d.end) - x(d.start); });
    scrapbook_space.selectAll('image').attr("x", function(d) {  return x(d.start); }).attr("width", sc_width);

}


/*
 ---- disable the brush for now.

svg.append("g")
    .attr("class", "brush")
    .call(d3.svg.brush().x(x).y(y)
    .on("brushstart", brushstart)
    .on("brush", brushmove)
    .on("brushend", brushend));

function brushstart() {
  svg.classed("selecting", true);
}

function brushmove() {
  var e = d3.event.target.extent();

}

function brushend() {
  svg.classed("selecting", !d3.event.target.empty());
}
*/

</script>
